#!/usr/bin/env bash
# run from directory where this script is
cd `echo $0 | sed 's/\(.*\)\/.*/\1/'` # extract pathname
EXAMPLE_DIR=`pwd`

# check whether echo has the -e option
if test "`echo -e`" = "-e" ; then ECHO=echo ; else ECHO="echo -e" ; fi

$ECHO
$ECHO "$EXAMPLE_DIR : starting"
$ECHO
$ECHO "This example shows how to use TBKOSTER.x to calculate the E(theta,phi) MAE of CoPt(643)"

# set the needed environment variables
. ../../../environment_variables

ulimit -s unlimited

rm -rf mft

mkdir mft


cat > in_master.txt<<EOF
&calculation
 processing = 'scf'
 post_processing = 'mft'
 /
&units
 length='ang'
 energy='ev'
 time='fs'
 mass='hau'
 /
&element
 ne = 2
 symbol(1) = 'Pt'
 symbol(2) = 'Co'
 u_lcn(1)=20
 u_lcn(2)=20
 i_stoner_d(1) = 0.60
 i_stoner_d(2) = 1.10
 xi_so_d(1)=0.45
 xi_so_d(2)=0.08
 /
&element_tb
 filename(1) = '$TBPARAM_DIR/pt_par_fcc_bcc_sc_lda_fl'
 filename(2) = '$TBPARAM_DIR/co_par_fcc_bcc_sc_gga_fl'
 /
&lattice
 v_factor =1.00000
 v(1,:) =  7.340383461373118, 0.0, 0.0
 v(2,:) = -3.1458786263027645, 8.19003250717428, 0.0
 v(3,:) =  0.0, 0.0, 26.82924432050779
 /
&atom
 ns = 2
 na = 67
 ntag = 2
 tag(1) = 'Pt'
 stag(1)=29
 tag(2) = 'Co'
 stag(2)=38
 pbc = 1, 1, 0
 r_coord='direct'
 r(1,:)=    0.575199976392,  0.988417546185,  0.039193169046   
 r(2,:)=    0.262489668058,  0.089218496588,  0.045913926842   
 r(3,:)=    0.948722950345,  0.191677250533,  0.052940265764	
 r(4,:)=    0.636876890458,  0.301182108033,  0.060346431073   
 r(5,:)=    0.3266745827  ,  0.406256606128,  0.068347643617   
 r(6,:)=    0.014703136834,  0.511030390732,  0.076293386696   
 r(7,:)=    0.703126752254,  0.621838368339,  0.083942050802   
r(8,:)=     0.388777015243,  0.725013519351,  0.092737148062   
r(9,:)=     0.077888352177,  0.83036755666 ,  0.100679912279   
r(10,:)=    0.771850170085,  0.936144045127,  0.113147295      
r(11,:)=    0.454466220943,  0.045649194264,  0.125444049155   
r(12,:)=    0.144396624482,  0.152122730956,  0.133669579194   
r(13,:)=    0.831304914309,  0.257500928641,  0.141612189647   
r(14,:)=    0.521279377737,  0.365398613423,  0.150161354486   
r(15,:)=    0.208330318506,  0.470144500526,  0.158685653549   
r(16,:)=    0.895825856421,  0.575330728037,  0.167182429347   
r(17,:)=    0.584169407257,  0.681626983223,  0.17604770785    
r(18,:)=    0.272396381968,  0.78726489859 ,  0.185065865317   
r(19,:)=    0.964678782094,  0.893649653837,  0.194936783537   
r(20,:)=    0.651722119091,  1.000970042161,  0.20534921761    
r(21,:)=    0.3415142731  ,  0.109142568649,  0.216469265037   
r(22,:)=    0.029045379763,  0.215968544852,  0.224732871999   
r(23,:)=    0.714821268717,  0.318561846324,  0.234471737177   
r(24,:)=    0.403277890617,  0.42635867816 ,  0.242568517104   
r(25,:)=    0.09164851748 ,  0.533565550326,  0.25075396514    
r(26,:)=    0.781547379692,  0.640265647408,  0.259142982238   
r(27,:)=    0.469770641532,  0.747310527083,  0.268018063147   
r(28,:)=    0.161639198376,  0.856133668175,  0.277528302937   
r(29,:)=    0.846820245127,  0.963495360112,  0.286022355423   
r(30,:)=    0.533383796214,  0.06351216239 ,  0.293886182077   
r(31,:)=    0.219470821205,  0.169097016834,  0.302175004848   
r(32,:)=    0.910907053511,  0.278726525448,  0.310390910536   
r(33,:)=    0.595188092054,  0.385456543131,  0.318377284617   
r(34,:)=    0.27868852459 ,  0.483606557377,  0.326375405589   
r(35,:)=    0.967213114754,  0.590163934426,  0.334446096674   
r(36,:)=    0.655737704918,  0.696721311475,  0.342446887206   
r(37,:)=    0.345202290465,  0.800301742624,  0.350430509739   
r(38,:)=    0.032786885246,  0.909836065574,  0.358943043464 
r(39,:)=    0.72131147541 ,  0.016393442623,  0.366632004443   
r(40,:)=    0.409836065574,  0.122950819672,  0.372934935611   
r(41,:)=    0.098360655738,  0.229508196721,  0.381286961209	
r(42,:)=    0.786885245902,  0.33606557377 ,  0.389027769487   
r(43,:)=    0.475409836066,  0.44262295082 ,  0.397079773448   
r(44,:)=    0.16393442623 ,  0.549180327869,  0.404735592387   
r(45,:)=    0.852459016393,  0.655737704918,  0.412354709487   
r(46,:)=    0.540983606557,  0.762295081967,  0.420028315658	
r(47,:)=    0.229508196721,  0.868852459016,  0.427494072803	
r(48,:)=    0.918032786885,  0.975409836066,  0.436544047462   
r(49,:)=    0.606557377049,  0.081967213115,  0.444983124038   
r(50,:)=    0.295081967213,  0.188524590164,  0.452664241659   
r(51,:)=    0.983606557377,  0.295081967213,  0.46014207218    
r(52,:)=    0.672131147541,  0.401639344262,  0.467585401552   
r(53,:)=    0.360655737705,  0.508196721311,  0.475176493775   
r(54,:)=    0.049180327869,  0.614754098361,  0.48263953709    
r(55,:)=    0.737704918033,  0.72131147541 ,  0.489866093245   
r(56,:)=    0.426229508197,  0.827868852459,  0.49665624603    
r(57,:)=    0.114754098361,  0.934426229508,  0.504258716198   
r(58,:)=    0.803278688525,  0.040983606557,  0.514790085233   
r(59,:)=    0.491803278689,  0.147540983607,  0.523846908595   
r(60,:)=    0.180327868852,  0.254098360656,  0.53099668409    
r(61,:)=    0.868852459016,  0.360655737705,  0.537148670543   
r(62,:)=    0.55737704918 ,  0.467213114754,  0.54426365403    
r(63,:)=    0.245901639344,  0.573770491803,  0.551580318139   
r(64,:)=    0.934426229508,  0.680327868852,  0.558831656643   
r(65,:)=    0.622950819672,  0.786885245902,  0.565056912034   
r(66,:)=    0.311475409836,  0.893442622951,  0.5712163245     
r(67,:)=    0.  	  ,  0. 	   ,  0.578564638708   
m_listing = 'by_tag'
m_coord = 'spherical'
m(1,:) = 0.0
m(2,:) = 2.0
 /
&mesh
 type = 'mp'
 gx = 5, 5, 1
 dx = 0, 0, 0
 /
&hamiltonian_tb

 /
&energy
 smearing = 'mv'
 degauss = 0.05
 /
&mixing
 alpha = 0.2
 /
&scf
 delta_en=0.00001
 delta_q=0.00001
 verbose=.true.
 ni_max=2000
 /
EOF

cat > mft/in_energy.txt<<EOF
&energy
 smearing = 'mv'
 degauss = 0.1
 en_min = -10.0
 en_max =  10.0
 /
EOF

cat > mft/in_mft.txt<<EOF
&mft
 calc='mae'
 type='mesh'
 na_mft=67
 nxa=50
 /
EOF

cat > mft/in_mesh.txt<<EOF
&mesh
 type = 'mp'
 gx = 10, 10, 1
 dx = 0, 0, 0
 /
EOF
# Run TBKOSTER
$BIN_DIR/TBKOSTER.x 


